# flask-mongo-cluster
**Важное уточнение** - Данная конфигурация предназначена для docker swarm на одной ноде и без использования docker machine.

1. Склонировать проект
2. Перейти в swarm mode - docker swarm
3. Запустить реплику приложения - docker stack deploy --compose-file docker-app-compose
5. При необходимости срегулировать кол-во реплик приложения (по стандарту - 3) - docker service scale flask_app=число
6. Запустить кластеризованный вариант mongodb (3 реплики - 1-read-write, 2-read) - docker-compose -f docker-mongo-compose
7. Приложение доступно по адресу - http://localhost:8080/


**Ремарка** - В виду своей технической реализации MondoDb не поддерживает динамическую кластеризацию в связи с этим нет смысла запускать её отдельно в swarm режиме. Кол-во реплик, а так же их связь задаётся вручную.   
**Важное уточнение** - Связывание реплик происходит через отдельный контейнер, однако для этого все реплики уже должны быть подняты в контейнерах. Однако,в зависимости от производительности вашей системы, контейнеры могут не успеть подняться и реплики не свяжутся в кластер. Во избежании этого в 4 контейнере, в скрипте, установлена задержка выполнения, но её может не хватить, так как, как говорилось ранее, скорость подъема контейнеров зависит сугубо от производительности вашей системы. В этом случае необходимо увеличивать задержку изменяя скрипт в mongo/scripts/setup.sh до тех пор, пока ваши контейнеры не поднимутся.



Dockerfile приложения - https://hub.docker.com/repository/docker/ripo4ek/itmo-task-flask-mongo (только для ознакомления, подтянется сам в docker compose)
